version: '2.1'
orbs:
  node: circleci/node@4.3.0
  coveralls: coveralls/coveralls@1.0.4
jobs:
  solhint:
    executor:
      name: node/default
      tag: '15.11'
    steps:
      - checkout
      - node/install-packages
      - run:
          command: |
            npm run solhint
            npm run lint-check
  coverage:
    executor:
      name: node/default
      tag: '15.11'
    steps:
      - checkout
      - node/install-packages
      - run:
          command:
            npm run coverage
      - coveralls/upload
      - store_artifacts:
          path: coverage
          prefix: coverage
  localDeployment:
    executor:
      name: node/default
      tag: '15.11'
    steps:
      - checkout
      - node/install-packages
      - run:
          command:
            npm run deploy-ci

workflows:
  tests:
    jobs:
      - node/test
  solhint:
    jobs:
      - solhint
  code_coverage:
    jobs:
      - coverage:
          context: 
            - Coveralls
  test_local_deployment:
    jobs:
      - localDeployment

notify:
  webhooks:
    - url: https://coveralls.io/webhook?repo_token=${COVERALLS_REPO_TOKEN}
